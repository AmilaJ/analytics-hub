<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Analytics>
    <Name>Sparkscript-hubAnalytics-LocationAPIReportsStats</Name>
    <Script>
 CREATE TEMPORARY TABLE ORG_WSO2TELCO_ANALYTICS_HUB_STREAM_LOCATION_PROCESSEDSTATISTICS
      USING CarbonAnalytics
      OPTIONS(tableName "ORG_WSO2TELCO_ANALYTICS_HUB_STREAM_LOCATION_PROCESSEDSTATISTICS");


CREATE TEMPORARY TABLE LocationHourlyTransactionLogSummary using CarbonAnalytics options (tableName "org_wso2telco_analytics_hub_stream_location_trasactionLog_summary_per_hour",
    schema "
    year INT -i,
    month INT -i,
    day INT -i,
    hour INT -i,
    eventTimeStamp STRING -i,
    api STRING -i,
    serviceProvider STRING -i,
    apiPublisher STRING -i,
    applicationName STRING -i,
    operatorId STRING -i,
    msisdn STRING -i,
    direction STRING -i,
    transactionOperationStatus STRING -i,
    clientCorrelator STRING -i,
    eventType STRING -i,
    responseCode STRING -i,
    totalCount INTEGER -i,
    serviceProviderId STRING -i,
    operatorName STRING -i,
    apiPublisherID STRING -i,
    apiID STRING -i,
    department STRING -i,
    applicationId STRING -i",
    primaryKeys "year,month,day,hour,eventTimeStamp,api,serviceProvider,apiPublisher,applicationName,operatorId,msisdn,direction,responseCode,clientCorrelator,eventType,transactionOperationStatus");

CREATE TEMPORARY TABLE LocationMonthlyTransactionLogSummary using CarbonAnalytics options (tableName "org_wso2telco_analytics_hub_stream_location_trasactionLog_summary_per_month",
        schema "
        year INT -i,
        month INT -i,
        day INT -i,
        hour INT -i,
        eventTimeStamp STRING -i,
        api STRING -i,
        serviceProvider STRING -i,
        apiPublisher STRING -i,
        applicationName STRING -i,
        operatorId STRING -i,
        msisdn STRING -i,
        direction STRING -i,
        transactionOperationStatus STRING -i,
        clientCorrelator STRING -i,
        eventType STRING -i,
        responseCode STRING -i,
        totalCount INTEGER -i,
        serviceProviderId STRING -i,
        operatorName STRING -i,
        apiPublisherID STRING -i,
        apiID STRING -i,
        department STRING -i,
        applicationId STRING -i",
        primaryKeys "year,month,day,hour,eventTimeStamp,api,serviceProvider,apiPublisher,applicationName,operatorId,msisdn,direction,responseCode,clientCorrelator,eventType,transactionOperationStatus"
        );

CREATE TEMPORARY TABLE LocationYearlyTransactionLogSummary using CarbonAnalytics options (tableName "org_wso2telco_analytics_hub_stream_location_trasactionLog_summary_per_year",
        schema "
        year INT -i,
        month INT -i,
        day INT -i,
        hour INT -i,
        eventTimeStamp STRING -i,
        api STRING -i,
        serviceProvider STRING -i,
        apiPublisher STRING -i,
        applicationName STRING -i,
        operatorId STRING -i,
        msisdn STRING -i,
        direction STRING -i,
        transactionOperationStatus STRING -i,
        clientCorrelator STRING -i,
        eventType STRING -i,
        responseCode STRING -i,
        totalCount INTEGER -i,
        serviceProviderId STRING -i,
        operatorName STRING -i,
        apiPublisherID STRING -i,
        apiID STRING -i,
        department STRING -i,
        applicationId STRING -i",
        primaryKeys "year,month,day,hour,eventTimeStamp,api,serviceProvider,apiPublisher,applicationName,operatorId,msisdn,direction,responseCode,clientCorrelator,eventType,transactionOperationStatus"
        );



        INSERT INTO TABLE LocationHourlyTransactionLogSummary SELECT year,month,day,hour,cast(getHourStartingTime(year, month, day,hour) as STRING)
        as eventTimeStamp,api,serviceProvider,apiPublisher,applicationName,operatorId,msisdn,direction,responseCode,clientCorrelator,eventType,
        transactionOperationStatus,count(transactionOperationStatus) as totalCount, serviceProvider, operatorName, apiPublisherID, apiID, department, applicationId FROM ORG_WSO2TELCO_ANALYTICS_HUB_STREAM_PAYMENT_PROCESSEDSTATISTICS GROUP BY
        year, month, day,hour,api,serviceProvider,apiPublisher,applicationName,operatorId,msisdn,direction,responseCode,clientCorrelator,eventType,transactionOperationStatus
        ,serviceProvider, operatorName, apiPublisherID, apiID, department, applicationId;




</Script>
    <CronExpression>0 0/30 * * * ?</CronExpression>
</Analytics>
  










 

                                                                               
                            
                            
